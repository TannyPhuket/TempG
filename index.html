<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üîê Smart Cold Guard Login</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module">
import { db } from "./js/firebase-config.js";
import { ref, get } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

async function loginUser() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const msg = document.getElementById("msg");

  if (!email || !password) {
    msg.textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
    msg.classList.remove("hidden");
    return;
  }

  try {
    const key = email.replace(/\./g, "@");
    const userRef = ref(db, "users/" + key);
    const snap = await get(userRef);

    if (!snap.exists()) {
      msg.textContent = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ";
      msg.classList.remove("hidden");
      return;
    }

    const role = snap.val().Role;
    if (role === "Buyer") {
      window.location.href = "dashboard_buyer.html";
    } else if (role === "Seller") {
      window.location.href = "dashboard_seller.html";
    } else if (role === "Driver") {
      window.location.href = "dashboard_driver.html";
    } else {
      msg.textContent = "‚ùå Role ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
      msg.classList.remove("hidden");
    }
  } catch (err) {
    msg.textContent = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase";
    console.error(err);
  }
}

window.loginUser = loginUser;
</script>
</head>
<body class="bg-gradient-to-br from-blue-100 via-white to-blue-50 min-h-screen flex items-center justify-center font-sans">
<div class="bg-white shadow-2xl rounded-3xl p-10 w-full max-w-md text-center">
  <h1 class="text-3xl font-bold text-blue-600 mb-6">‚ùÑÔ∏è Smart Cold Guard</h1>
  <input id="email" placeholder="Email" class="w-full px-4 py-3 mb-3 border rounded-lg"/>
  <input id="password" type="password" placeholder="Password" class="w-full px-4 py-3 mb-4 border rounded-lg"/>
  <button onclick="loginUser()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
  <p id="msg" class="hidden mt-4 text-red-500 font-medium"></p>
</div>
</body>
</html>
