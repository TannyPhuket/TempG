<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ColdGuard Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {margin:0;font-family:Arial;background:#1b1b1b;color:#f5f5f5;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:#1c1c1c;color:#f1c40f;}
.logout-btn{cursor:pointer;font-size:22px;color:#f1c40f;background:none;border:none;}
.container{padding:20px;}
.card-container{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;}
.card{flex:1 1 200px;padding:20px;border-radius:10px;text-align:center;font-weight:bold;color:#fff;}
.card.temp{background:#e67e22;}
.card.hum{background:#2ecc71;}
.card.status{background:#3498db;}
#map{height:350px;border-radius:12px;margin-bottom:20px;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
    <h1>ColdGuard Dashboard (<span id="roleLabel"></span>)</h1>
    <button class="logout-btn" onclick="logout()">ðŸšª Logout</button>
</header>

<div class="container">
    <!-- Seller Only -->
    <div id="settings" class="hidden">
        <h3>Temperature Alert Setting</h3>
        <input type="number" id="alertTemp" placeholder="Max Â°C">
        <button onclick="saveAlert()">Save</button>
    </div>

    <!-- Cards -->
    <div class="card-container">
        <div class="card temp">Temperature: <span id="cardTemp">--</span>Â°C</div>
        <div class="card hum">Humidity: <span id="cardHum">--</span>%</div>
        <div class="card status">Status: <span id="cardStatus">--</span></div>
    </div>

    <!-- Map -->
    <div id="map"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBHCnAFJHBz95ugYztMkxBa5b6fwqCZqfo",
  authDomain: "temperature-cold-guard.firebaseapp.com",
  databaseURL: "https://temperature-cold-guard-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "temperature-cold-guard",
  storageBucket: "temperature-cold-guard.firebasestorage.app",
  messagingSenderId: "29693405672",
  appId: "1:29693405672:web:9815de4ba98e7e4cf3dc5d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Role
let role = localStorage.getItem('role');
if(!role){ window.location.href="login.html"; } // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™ à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² login
document.getElementById('roleLabel').textContent = role;

// âœ… à¹à¸ªà¸”à¸‡à¹€à¸¡à¸™à¸¹ Seller
if(role === 'Seller'){
    document.getElementById('settings').classList.remove('hidden');
}

// Leaflet Map
const map = L.map('map').setView([13.736717, 100.523186], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker = null;

// à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¸ˆà¸²à¸ Firebase
const recordsRef = ref(db,"records/latest");
onValue(recordsRef, snap=>{
    const data = snap.val();
    if(!data) return;

    document.getElementById("cardTemp").textContent = data.temperature;
    document.getElementById("cardHum").textContent = data.humidity;
    document.getElementById("cardStatus").textContent = data.status;

    if(data.gps){
        const lat = data.gps.lat;
        const lng = data.gps.lng;
        if(!marker){ marker = L.marker([lat,lng]).addTo(map); }
        else{ marker.setLatLng([lat,lng]); }
        map.setView([lat,lng],13);
    }
});

// Logout
function logout(){
    localStorage.removeItem('role');
    window.location.href="login.html";
}

// Seller Save Alert
function saveAlert(){
    const val = document.getElementById('alertTemp').value;
    update(ref(db,"settings"),{ alertTemperature: Number(val) });
    alert("Saved!");
}
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ColdGuard Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {margin:0;font-family:Arial;background:#1b1b1b;color:#f5f5f5;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px;background:#1c1c1c;color:#f1c40f;}
.logout-btn{cursor:pointer;font-size:22px;color:#f1c40f;background:none;border:none;}
.container{padding:20px;}
.card-container{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap;}
.card{flex:1 1 200px;padding:20px;border-radius:10px;text-align:center;font-weight:bold;color:#fff;}
.card.temp{background:#e67e22;}
.card.hum{background:#2ecc71;}
.card.status{background:#3498db;}
#map{height:350px;border-radius:12px;margin-bottom:20px;}
.hidden{display:none;}
</style>
</head>
<body>

<header>
    <h1>ColdGuard Dashboard (<span id="roleLabel"></span>)</h1>
    <button class="logout-btn" onclick="logout()">ðŸšª Logout</button>
</header>

<div class="container">
    <!-- Seller Only -->
    <div id="settings" class="hidden">
        <h3>Temperature Alert Setting</h3>
        <input type="number" id="alertTemp" placeholder="Max Â°C">
        <button onclick="saveAlert()">Save</button>
    </div>

    <!-- Cards -->
    <div class="card-container">
        <div class="card temp">Temperature: <span id="cardTemp">--</span>Â°C</div>
        <div class="card hum">Humidity: <span id="cardHum">--</span>%</div>
        <div class="card status">Status: <span id="cardStatus">--</span></div>
    </div>

    <!-- Map -->
    <div id="map"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBHCnAFJHBz95ugYztMkxBa5b6fwqCZqfo",
  authDomain: "temperature-cold-guard.firebaseapp.com",
  databaseURL: "https://temperature-cold-guard-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "temperature-cold-guard",
  storageBucket: "temperature-cold-guard.firebasestorage.app",
  messagingSenderId: "29693405672",
  appId: "1:29693405672:web:9815de4ba98e7e4cf3dc5d"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// âœ… à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Role
let role = localStorage.getItem('role');
if(!role){ window.location.href="login.html"; } // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™ à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² login
document.getElementById('roleLabel').textContent = role;

// âœ… à¹à¸ªà¸”à¸‡à¹€à¸¡à¸™à¸¹ Seller
if(role === 'Seller'){
    document.getElementById('settings').classList.remove('hidden');
}

// Leaflet Map
const map = L.map('map').setView([13.736717, 100.523186], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker = null;

// à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¸ˆà¸²à¸ Firebase
const recordsRef = ref(db,"records/latest");
onValue(recordsRef, snap=>{
    const data = snap.val();
    if(!data) return;

    document.getElementById("cardTemp").textContent = data.temperature;
    document.getElementById("cardHum").textContent = data.humidity;
    document.getElementById("cardStatus").textContent = data.status;

    if(data.gps){
        const lat = data.gps.lat;
        const lng = data.gps.lng;
        if(!marker){ marker = L.marker([lat,lng]).addTo(map); }
        else{ marker.setLatLng([lat,lng]); }
        map.setView([lat,lng],13);
    }
});

// Logout
function logout(){
    localStorage.removeItem('role');
    window.location.href="login.html";
}

// Seller Save Alert
function saveAlert(){
    const val = document.getElementById('alertTemp').value;
    update(ref(db,"settings"),{ alertTemperature: Number(val) });
    alert("Saved!");
}
</script>
</body>
</html>
