<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tracking Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>

<div class="grid">
  <div class="box">
    <h3>Status</h3>
    <p id="status">Waiting...</p>
  </div>

  <div class="box">
    <h3>Temperature</h3>
    <p id="temp">-- °C</p>
  </div>

  <div class="box">
    <h3>Location</h3>
    <p id="location">Not found</p>
  </div>
</div>

<div id="map"></div>

<script type="module">
import { db } from "./firebase.js";
import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

const role = localStorage.getItem("role");
if(!role) location.href="index.html";

const map = L.map('map').setView([13.7, 100.5], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker = L.marker([13.7,100.5]).addTo(map);

const TEMP_LIMIT = 5;

onValue(ref(db,"sensor"), snap=>{
  const d = snap.val();
  if(!d) return;

  // Temperature
  document.getElementById("temp").innerText = d.temperature+" °C";

  if(d.temperature > TEMP_LIMIT){
    document.getElementById("status").innerText = "High Temperature";
  }else{
    document.getElementById("status").innerText = "Low Temperature";
  }

  // Location
  if(d.lat === 0 || d.lng === 0 || d.lng === undefined){
    document.getElementById("location").innerText = "Not found";
  }else{
    document.getElementById("location").innerText =
      d.lat.toFixed(5)+", "+d.lng.toFixed(5);
    marker.setLatLng([d.lat, d.lng]);
    map.setView([d.lat, d.lng], 14);
  }
});
</script>

</body>
</html>
