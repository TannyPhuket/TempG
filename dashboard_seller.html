<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Cold Guard â€“ Seller Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script type="module">
    import { db } from "./js/firebase-config.js";
    import { ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    function $(id) {
      return document.getElementById(id);
    }

    // à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Firebase à¹à¸šà¸š Real-time
    function loadData() {
      const dataRef = ref(db, "data");
      const settingsRef = ref(db, "settings");

      // ğŸ”¥ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‹à¹‡à¸™à¹€à¸‹à¸­à¸£à¹Œ -------------------
      onValue(dataRef, (snap) => {
        if (snap.exists()) {
          const v = snap.val();

          $("temp").textContent = v.temperature + " Â°C";
          $("humidity").textContent = v.humidity + " %";

          // GPS
          if (v.gps) {
            $("lat").textContent = v.gps.lat;
            $("lng").textContent = v.gps.lng;

            // à¹à¸ªà¸”à¸‡à¸šà¸™à¹à¸œà¸™à¸—à¸µà¹ˆ
            updateMap(v.gps.lat, v.gps.lng);
          }

          checkStatus(v.temperature);
        }
      });

      // ğŸ”¥ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² -----------------------
      onValue(settingsRef, (snap) => {
        if (snap.exists()) {
          const s = snap.val();
          $("minTemp").textContent = s.minTemp + " Â°C";
          $("maxTemp").textContent = s.maxTemp + " Â°C";
        }
      });
    }

    // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´
    function checkStatus(temp) {
      const min = parseFloat($("minTemp").textContent);
      const max = parseFloat($("maxTemp").textContent);

      const stat = $("status");

      if (temp < min) {
        stat.textContent = "â„ à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸™";
        stat.className = "text-blue-600 font-bold";
      } else if (temp > max) {
        stat.textContent = "ğŸ”¥ à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸²à¸¡à¸²à¸•à¸£à¸à¸²à¸™";
        stat.className = "text-red-600 font-bold";
      } else {
        stat.textContent = "âœ” à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡";
        stat.className = "text-green-600 font-bold";
      }
    }

    // à¹à¸œà¸™à¸—à¸µà¹ˆ --------------------
    let map;
    function updateMap(lat, lng) {
      if (!map) {
        map = L.map("map").setView([lat, lng], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
          .addTo(map);
      }
      L.marker([lat, lng]).addTo(map);
    }

    window.onload = loadData;
  </script>

  <!-- Leaflet map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>
<body class="bg-gray-100 p-6">

  <h1 class="text-3xl font-bold text-blue-600 mb-6">ğŸ“¦ Seller Dashboard</h1>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ -->
    <div class="p-6 bg-white shadow rounded-xl">
      <h2 class="text-xl font-bold mb-2">ğŸŒ¡ à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´</h2>
      <p id="temp" class="text-4xl font-bold text-blue-500">-- Â°C</p>
      <p id="status" class="mt-2 text-gray-600"></p>
    </div>

    <!-- à¸„à¸§à¸²à¸¡à¸Šà¸·à¹‰à¸™ -->
    <div class="p-6 bg-white shadow rounded-xl">
      <h2 class="text-xl font-bold mb-2">ğŸ’§ à¸„à¸§à¸²à¸¡à¸Šà¸·à¹‰à¸™</h2>
      <p id="humidity" class="text-4xl font-bold text-cyan-500">-- %</p>
    </div>

    <!-- à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸‚à¸­à¸šà¹€à¸‚à¸• -->
    <div class="p-6 bg-white shadow rounded-xl">
      <h2 class="text-xl font-bold mb-2">âš™ï¸ à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</h2>
      <p>à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸•à¹ˆà¸³à¸ªà¸¸à¸”: <span id="minTemp">--</span></p>
      <p>à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸ªà¸¹à¸‡à¸ªà¸¸à¸”: <span id="maxTemp">--</span></p>
    </div>

  </div>

  <!-- GPS -->
  <div class="mt-6 p-6 bg-white shadow rounded-xl">
    <h2 class="text-xl font-bold mb-4">ğŸ“ à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ GPS</h2>
    <p>Lat: <span id="lat">--</span></p>
    <p>Lng: <span id="lng">--</span></p>
    <div id="map" class="w-full h-72 mt-4 rounded-xl"></div>
  </div>

</body>
</html>
