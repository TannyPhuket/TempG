<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Seller Dashboard - Smart Cool Guard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f2f5f9;
}
header{
  background:#f39c12;
  color:#fff;
  padding:15px 30px;
  font-size:20px;
  font-weight:bold;
}
.container{
  padding:20px;
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
}
.card{
  background:#fff;
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
.card h3{
  margin-top:0;
  color:#2c3e50;
}
.value{
  font-size:28px;
  font-weight:bold;
}
.status-normal{color:#27ae60;}
.status-high{color:#e74c3c;}
.status-low{color:#3498db;}

#map{
  height:300px;
  border-radius:12px;
}
</style>
</head>

<body>
<header>Seller Dashboard – Smart Cool Guard</header>

<div class="container">
  <div class="card">
    <h3>Temperature</h3>
    <div class="value" id="temp">-- °C</div>
  </div>

  <div class="card">
    <h3>Humidity</h3>
    <div class="value" id="hum">-- %</div>
  </div>

  <div class="card">
    <h3>Status</h3>
    <div class="value" id="status">--</div>
  </div>

  <div class="card">
    <h3>Location</h3>
    <div id="locationText">Not found</div>
  </div>

  <div class="card" style="grid-column:1/-1">
    <h3>GPS Map</h3>
    <div id="map"></div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBHCnAFJHBz95ugYztMkxBa5b6fwqCZqfo",
  databaseURL: "https://temperature-cold-guard-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ---------- CONFIG ----------
const TEMP_MIN = 2;
const TEMP_MAX = 8;

// ---------- MAP ----------
let map = L.map('map').setView([13.7563, 100.5018], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker = L.marker([13.7563, 100.5018]).addTo(map);

// ---------- DOM ----------
const tempEl = document.getElementById("temp");
const humEl = document.getElementById("hum");
const statusEl = document.getElementById("status");
const locText = document.getElementById("locationText");

// ---------- LISTEN ----------
onValue(ref(db, "latest"), snap => {
  if(!snap.exists()) return;
  const d = snap.val();

  const temp = d.temperature;
  const hum  = d.humidity;
  const lat  = d.gps?.lat ?? 0;
  const lng  = d.gps?.lng ?? 0;

  tempEl.textContent = temp.toFixed(1) + " °C";
  humEl.textContent  = hum.toFixed(1) + " %";

  // ---- STATUS ----
  if(temp > TEMP_MAX){
    statusEl.textContent = "High Temperature";
    statusEl.className = "value status-high";
  }else if(temp < TEMP_MIN){
    statusEl.textContent = "Low Temperature";
    statusEl.className = "value status-low";
  }else{
    statusEl.textContent = "Normal";
    statusEl.className = "value status-normal";
  }

  // ---- MAP ----
  if(lat === 0 || lng === 0 || isNaN(lat) || isNaN(lng)){
    locText.textContent = "Location: Not found";
    return;
  }

  locText.textContent = `Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}`;
  marker.setLatLng([lat,lng]);
  map.setView([lat,lng], 15);
});
</script>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>
</html>
