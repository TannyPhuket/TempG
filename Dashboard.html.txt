<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üå°Ô∏è Smart Cold Guard Dashboard</title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏£‡∏µ) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    // Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const firebaseConfig = {
      apiKey: "AIzaSyBHCnAFJHBz95ugYztMkxBa5b6fwqCZqfo",
      authDomain: "temperature-cold-guard.firebaseapp.com",
      databaseURL: "https://temperature-cold-guard-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "temperature-cold-guard",
      storageBucket: "temperature-cold-guard.firebasestorage.app",
      messagingSenderId: "29693405672",
      appId: "1:29693405672:web:9815de4ba98e7e4cf3dc5d",
      measurementId: "G-XDHBRJ9S3W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Leaflet
    const map = L.map('map').setView([14.12345, 100.98765], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏î
    const marker = L.marker([14.12345, 100.98765]).addTo(map);

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
    const dataRef = ref(db, 'Data');
    onValue(dataRef, (snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        const lat = data.GPS?.lat || 0;
        const lng = data.GPS?.lng || 0;
        const temp = data.Temperature || 0;
        const hum = data.Humidity || 0;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        document.getElementById('temperature').textContent = temp.toFixed(2) + " ¬∞C";
        document.getElementById('humidity').textContent = hum.toFixed(2) + " %";
        document.getElementById('timestamp').textContent = new Date(data.timestamp || Date.now()).toLocaleString("th-TH");

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏°‡∏∏‡∏î
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng]);

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏´‡∏°‡∏∏‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
        const iconColor = temp > -10 ? "red" : temp < -18 ? "blue" : "green";
        const icon = L.divIcon({
          className: "temp-marker",
          html: `<div style="background:${iconColor};width:16px;height:16px;border-radius:50%;border:2px solid white;"></div>`
        });
        marker.setIcon(icon);
      }
    });
  </script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: calc(100vh - 160px);
    }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-100 via-white to-blue-50 font-sans">
  <header class="bg-blue-600 text-white text-center py-4 shadow-lg">
    <h1 class="text-2xl font-bold">‚ùÑÔ∏è Smart Cold Guard Dashboard</h1>
    <p class="text-sm opacity-80">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏π‡πâ‡πÅ‡∏ä‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
  </header>

  <main class="p-4 flex flex-col items-center">
    <div class="bg-white rounded-2xl shadow-md w-full max-w-3xl p-6 text-center mb-4">
      <div class="grid grid-cols-3 gap-4 text-lg">
        <div>
          <p class="text-gray-500">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</p>
          <p id="temperature" class="text-2xl font-bold text-blue-600">-- ¬∞C</p>
        </div>
        <div>
          <p class="text-gray-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</p>
          <p id="humidity" class="text-2xl font-bold text-blue-600">-- %</p>
        </div>
        <div>
          <p class="text-gray-500">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
          <p id="timestamp" class="text-base font-semibold text-gray-700">--</p>
        </div>
      </div>
    </div>

    <div id="map" class="rounded-2xl shadow-md w-full max-w-5xl"></div>
  </main>
</body>
</html>
